---
title: 麻雀プログラム 局終了仕様
---

## 一局の終了

ハイテイ流局、途中流局、和了終局の三つに分類したい。

### ハイテイ牌について

* ハイテイ牌の一つ前の牌がカンされた場合、リンシャンから補充した牌をハイテイ牌のように扱うものとする。
* ハイテイ牌に対してはツモ・ロンしかプレイヤーに認めない。
  * 鳴きはすべて不可とする。とくにハイテイをツモるプレイヤーはその手番で加槓・暗槓不能とする。

牌山が尽きたら流局であるので、牌山の管理の都合上通常ツモ時にカウンターを仕込むのが楽。
カンの宣言でハイテイがずれるときにもこの考え方は有効だ。

あるいは、誰かが山やリンシャンからの補充により 70 からカウントダウンするという方式でもいいい。
ハイテイ牌がツモられている間にカウンターの値は 0 である。

### 通常流局

ハイテイ牌が場に切られたときに次のようになれば通常流局が確定する：

* 誰からもアガリのコールがない
* 流し満貫が成立しているプレイヤーがいない

流局確定後、次を処理する：

* 四人全員のテンパイ状況を示す。
  * テンパイしている者は（強制で）手を開く。
    * 参考：MJ だと待ち牌の表示までついて便利だ。
  * テンパイしていない物は手牌を伏せる。
  * ノーテン罰符の授受を執行する。
    * 全員テンパイ：なし
    * 一人ノーテン：3000 点を残りの三人に分配
    * 二人ノーテン：1500 点ずつ残りの二人に移動
    * 一人テンパイ：残り三人から 1000 点ずつ獲得
    * 全員ノーテン：なし
* [トビテスト]
* [親番を解決する]
* [本場を解決する]

### 途中流局

次の状況が発生したときには[親が流れる流局]をする：

* 四風子連打
* 四槓算了
* 三家和（オプション）

次の状況が発生したときには[親が流れない流局]をする：

* 九種九牌
* 四家立直（オプション）

#### 四風子連打

開局直後、一巡目の東家、南家、西家、北家の捨牌が同一の風牌であるとする。
このとき四風子連打例外が送出するものとする。その結果流局になるものとする。

#### 四槓算了

槓子が 4 組卓上に成立した（＝搶槓が発生しない）瞬間、
それらが二人以上のプレイヤーのものに及ぶ場合には、四槓算了例外が送出するとする。
その結果流局になるものとする。

#### 三家和（オプション）

トリプルロンの宣言が成立した瞬間、かつ三家和流局オプションが有効化されている場合には、
三家和例外が送出し、その結果流局になるものとする。

#### 九種九牌

開局直後の一巡目の各プレイヤー手番かつ、一度も鳴きが宣言されていないとする。
手番のプレイヤーの手にある 14 枚のうち 9 枚が相異なる么九牌・字牌からなるとき、
そのプレイヤーは直後に九種九牌流局を（選択的に）宣言することが許されるものとする。

九種九牌流局を宣言する場合、九種九牌例外が送出する。
宣言しない場合、プレイヤーは別の振る舞い（暗槓の宣言または牌を切ることの可能性がある）をすることで手番を終えて局を続行する。

#### 四家立直（オプション）

四人目のリーチが成立した瞬間、かつ四家立直流局オプションが有効化されている場合には、
三家和例外が送出し、その結果流局になるものとする。

### 和了終局

誰かによるアガリ宣言をもって和了終局が確定する。

初版では頭ハネを採用する（ダブロンありの仕様でも頭ハネの概念が存在する）。

* 和了者に供託リー棒を獲得点棒に追加する。
* 和了者がツモアガリである場合
  * それ以外の三人との間で点棒授受。
* 和了者がロンアガリである場合
  * 放銃者との間で点棒授受。
* [トビテスト]
* [親番を解決する]
* [本場を解決する]

### トビテスト

* 全員について点棒がゼロを下回るか判定する。
* 一人でもトビがいればハコ下終了例外を送出する。

### 本場を解決する

* 連荘確定または流局であるならば
  * 本場のカウント数を 1 増やす。
  * 親が流れるときは
    * 古い親の右手に置いていた百点棒をすべて点棒箱に戻す。
    * 新しい親の右手に百点棒を今の本数プラス 1 だけ置く。
  * 連荘のときは
    * 現在の親の右手に百点棒一本を追加的に置く。
* 子が和了（かつ親がノー和了）ならば
  * 局数を 1 増やす。
  * 本場のカウント数を 0 にリセットする。
  * 古い親の右手に置いていた百点棒をすべて点棒箱に戻す。

### 親番を解決する

終局確定直後、親番が変わるかどうかが確定する。

* 終局理由が親による和了終局、テンパイ連荘ルール採用時の親のテンパイ通常流局、九種九牌流局、四家立直流局（オプション）のいずれかならば
  * オーラスでない局ならば親番続行とする。
  * オーラスが終局したならば
    * 親がトップ目でないならば親番続行とする。
    * 親がトップ目であるならば試合終了とする（アガリやめ）。
* それ以外は親番を更新する。
  今の東家、南家、西家、北家をそれぞれ次の北家、東家、南家、西家とする。
