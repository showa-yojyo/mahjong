---
title: 麻雀プログラム セットアップ仕様
---

## ゲームのセットアップ

事前条件：プレイヤーが四人集まって仮の座席に着いている。

事後条件：

* 東一局における四人の座席が確定した。
* 卓上の適切な位置に起家マークが表示された。
* 四人に配給原点が設定された。

* つかみ取りを simulate する。
  風牌一種一枚ずつを来場順に `random.choice()` する。
  あるいは `random.shuffle()` して順に対応させでもよい。
* 起家マークを出力する。東を引いた者は席を変えない。
* 南、西、北を引いたものをそれぞれ南家、西家、北家の席に動かす。
* 全員の席を出力する。
* 原点を全員に対して分配する。
  * 東風ならば 20000 点ぶんの点棒を、半荘ならば 25000 点ぶんを分配する。

以上の手続きは仮東を決めるものだとする流儀もあるが、電子麻雀なので本親が決まるものとする。

### 配給原点詳細

ゲーム開始時に各プレイヤーに配布する点棒の組み合わせは次のようにする。

* 東風戦 20000 点
  * 一万点棒 1
  * 五千点棒 1
  * 千点棒 4
  * 五百点棒 1
  * 百点棒 5
* 半荘戦 25000 点
  * 東風戦の組み合わせに五千点棒を 1 本追加する。

## 一局のスタートアップ

* 必要なら場風を更新する。
* 必要なら四人の風を更新する。
  * 局数が変化したときに限り、風が反時計回りに座席を動く。
* 局名を出力する。例：「東三局三本場」
  * 供託を出力する。リー棒とシバ棒。
* 牌山を初期化する：牌山が四人の前に築かれる。
* 東家がサイコロを振る。割れ目が確定する。
  自動雀卓の場合：東家がボタンを押すとサイコロが振られ始める。
* [開門]
* [ドラめくり]
* [配牌]

### 開門

事前条件：牌山初期化済みかつサイコロ転がし済み
事後条件：王牌が確定する

* サイコロの目の和を `dicesum` とする。
  数 `dicesum % 4` が 0, 1, 2, 3 のときそれぞれ東家、南家、西家、北家の前の牌山に注目する。
  注目している牌山に対応するプレイヤーから見て右から `dicesum` トン目で牌山を分割する。

### 王牌

* 割れ目から右にある 7 トンを王牌とする。割れ目の位置によっては牌山の角をまたいでもよい。
* 王牌右端と海底の間に隙間を開ける。
* 割れ目のプレイヤーは王牌左から一番目の上段の牌を隣の空間に下ろす。

### ドラめくり

* ドラ表示牌をめくる
  * その正面にいるプレイヤーが王牌左から三番目の上段の牌をめくる。

表示牌とドラの対応関係は次の通り：

* 一萬から八萬はそれぞれの次の数の萬子をドラとする。
* 九萬は一萬をドラとする。
* 筒子と索子もそれぞれ萬子のドラの対応関係に準じる。
* 東、南、西、北はそれぞれ南、西、北、東をドラとする。
* 白、発、中はそれぞれ発、中、白をドラとする。

### 配牌

ドラ表示牌をめくったあと、配牌を開始する。

* 牌の取り出し位置 := 牌山割れ目のすぐ左（の上段）
* 東家、南家、西家、北家の順に以下を 3 ループ
  * 牌の取り出し位置から左にある 2 トン 4 牌をつまんでプレイヤーの卓上に持ってくる。
  * プレイヤーの手牌にその 4 牌を追加する。

この時点で全員 12 牌ずつある。

* 東家がチョンチョンで 2 牌手牌に追加する。
  * 牌の取り出し位置と、その二つ隣の牌を取り出す。
  * 東家は全員の配牌が終わるまで待機状態とする。
* 南家、西家、北家の順に自然な位置から 1 牌ずつ取り出し、各手牌に追加する。
* 東家の待機状態を解除する。
