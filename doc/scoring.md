---
title: 麻雀プログラム 得点仕様
---

得点はすべてシステムが計算するものとする。
システムは和了形をその得点が最大であるように解釈するものとする。

プレイヤー全員の最新の持ち点を卓上の所定の場所に表示するものとする。
局の進行中には、手番でないプレイヤーは常に任意のプレイヤーの最新の持ち点を確認できるものとする。

* 総飜数を決定する。
  * 手役から定まる飜数を確定する。この値はゼロではないはずだ。
  * 手牌に含まれるドラ、カンドラ、裏ドラの和を取る。
  * これらの総和を総飜数とする。
* 符を決定する。
  * 総飜数が 5 以上ならば符計算を行わない。
  * 一の位は十の位に繰り上げるものとする。例：32 符は 40 符とする。
  * 七対子の場合には例外的に 25 符とする（繰り上げはしない）。

ツモアガリの場合にはここに 100 点を加えることになるかもしれない。

手牌から決まる獲得点とは別に、卓上のリー棒と本場点を加算する。

* 和了者が複数いる場合は
  * リー棒は上家取りとする。
    * リーチ宣言者が和了すると彼のリー棒は点棒箱にどんな場合でも戻る。
  * 放銃者は各和了者に個別に手牌から決まる獲得点を支払う。本場点も加える。一本場 300 点とする。

誰かの点棒がゼロを下回った場合、ゲームを終了して結果画面に移行する。

## 符計算

副底は次の通りとする（いずれか一つの場合しか成り立たない）：

| 条件   |   符 | コメント               |
| ------ | ---: | ---------------------- |
| 門前   |   30 |                        |
| 七対子 |   25 | 一の位を繰り上げない   |
| その他 |   20 | ツモアガリまたは副露手 |

ここに面子構成から定まる符を加える。刻子と槓子は別扱いとする。

| 面子           |   符 |
| -------------- | ---: |
| 中張牌の明刻   |    2 |
| 中張牌の暗刻   |    4 |
| 非中張牌の明刻 |    4 |
| 非中張牌の暗刻 |    8 |
| 中張牌の明槓   |    8 |
| 中張牌の暗槓   |   16 |
| 非中張牌の明槓 |   16 |
| 非中張牌の暗槓 |   32 |

シャンポン待ちのテンパイでアガったときには、ツモアガリならば暗刻として、
ロンアガリならば明刻として符を解決する。

次の場合それぞれに対して追加的に 2 符を加算する：

* 雀頭が三元牌、自風牌、場風牌のいずれかである。
  * 東場で親が雀頭が東である和了形は 2 符しか加算しない。
* 辺張待ち、嵌張待ち、単騎待ちのいずれかでのアガリである
* （平和でない）ツモアガリである
* 門前でない平和である

ここでの単騎待ちとは、雀頭が未完成のテンパイを意味する。

待ちの解釈が複数成り立つならば、最大点原則に従うものとする。
例えば両面待ちにも辺張待ちにもとれるならば、2 符が付く後者を採用する。

ツモアガリの場合には役に平和がないときに限り 2 符を加えるものとする。

門前手ではないが平和形のアガリに対しては 2 符を加えるものとする（結果的に 30 符になる）。

## 計算仕様

何符何飜かが確定したら、システムは計算済み得点表の検索処理で得失点を決定するものとする
（何符何飜と得点の対応を作っておく）。

以下、得点表の作成法を説明する。

* 5 飜以上の手については満貫以上用の得点表を参照し、その値を点棒で支払う。
* そうでない手については次のようにして失点を計算する：
  * `最終符 * 2 ** (飜数 + 2)` を計算する。
    * 親のアガリの場合、これを `*= 2` する。
    * 支払い者が親の場合、これを `*= 2` する。
  * ここまでの値を基準値と呼ぶことにする。
  * 基準値の十の位を切り上げる。
  * この値を点棒で和了者に支払う。

以上はツモアガリの場合の他家の支払いに適用する。
ロンアガリの場合、放銃者は和了者に点棒をすべて支払い、それ以外のものは支払わないものとする。

* 和了者が子であれば基準値を `*= 4` とする。
* 和了者が親であれば基準値を `*= 3` とする。
* 値が和了者の満貫点を超える場合、満貫扱いとする。

いずれの場合でも、和了者はリー棒と本場棒を加える。

* `n` 本場の局のアガリでは `300 * n` 点を非和了者全員で分配して和了者に支払う。

### 切り上げ満貫

60 符 3 飜および 30 符 4 飜の和了を満貫の和了として扱う。
つまり 60 符以上 3 飜および 30 符以上 4 飜を満貫とする。

## 役表

得点表は和了者が親か子かにより大分類し、それからアガリがツモかロンかで小分類する。
得点表は飜と符をそれぞれ列と行にする。

* 親
  * ツモ
  * ロン
* 子
  * ツモ
  * ロン

コードではキーが符と飜で値が子・親の失点の辞書とするか、入れ子の辞書になるだろう。

アガリが 5 飜以上については得点の決定に符が関係しない。親の場合は次のようにする。

| 和了   | 飜       |  ツモ |  ロン |
| ------ | -------- | ----: | ----: |
| 満貫   | 5        |  4000 | 12000 |
| 跳満   | 6, 7     |  6000 | 18000 |
| 倍満   | 8, 9, 10 |  8000 | 24000 |
| 三倍満 | 11, 12   | 12000 | 36000 |
| 役満   | 13+      | 16000 | 48000 |

子の場合は次のようにする。

| 和了   | 飜       | ツモ（子・親） |  ロン |
| ------ | -------- | -------------: | ----: |
| 満貫   | 5        |   (2000, 4000) |  8000 |
| 跳満   | 6, 7     |   (3000, 6000) | 12000 |
| 倍満   | 8, 9, 10 |   (4000, 8000) | 16000 |
| 三倍満 | 11, 12   |  (6000, 12000) | 24000 |
| 役満   | 13+      |  (8000, 16000) | 36000 |

リー棒および本場棒は別途発生する。
