---
title: 麻雀プログラム ゲーム進行仕様
---

セットアップ仕様を先に読むこと。

## ゲーム進行

プレイヤーの手番とは、ある牌を山からツモってから、ある牌が手から捨てられるまでとする。

東南西北の四人全員に手番が一度ずつ回ることを一巡するという。
この一巡は次の意味で中断されるものとする：

* 暗槓が宣言される。
* 捨牌が鳴きの対象になる。

一局はあるプレイヤーが和了するか流局するまで終わらない。

東場ではすべてのプレイヤーが順番に親となる。
東風戦ならば完全なゲームは東場からなる。半荘戦ならば完全なゲームは東場と南場からなる。

例：東風戦のとあるゲーム内容は 7 局から

1. 東一局：西家和了
2. 東二局：東家和了
3. 東二局一本場：北家九種九牌
4. 東二局二本場：通常流局
5. 東三局二本場：南家和了
6. 東四局（オーラス）：東家和了
7. 東四局一本場（オーラス）：北家トビ

## プレイヤーの手番

プレイヤーは東南西北の順に手番が回るものとする。

プレイヤーの手番は牌を引くことで開始するものとする。
ただし、親はチョンチョンで 14 牌ある状態から開始するので、最初の手番では牌を引かないともみなせる。
いずれにせよ最初に牌を捨てることができるには親しかいない。

プレイヤーがアガリもカンも宣言できない・するつもりがないときは、
そのプレイヤーは副露されていない手牌のうちの牌を一つ捨てることで手番を終了する。

開局直後、子全員が彼らの手牌を確認して理牌を終えるまで、親は牌を捨てるのを待機するものとする。

* ビデオゲームなので、北家の配牌が終わった時点で待機解除でよい。

各プレイヤーについて、捨牌は河に並べるものとする。

* 対応するプレイヤーから見てその正面の卓上の中央から手前、山の奥までに左から右に 6 牌を捨てて一段とする。
* 一段目が終わったら二段、三段と重ねる。
* 四段目はないものとする。さらなる捨牌を三段目の右に並べていく。

### 鳴きの優先順位とタイミング

ポン・大明槓は、直近に捨てられた牌に対してしかできず、次のプレイヤーが牌を引くまでの間とする。

ロンが宣言できるのは、直近に捨てられた牌のみとし、次のプレイヤーが牌を引くまでの間とする。

ポン・大明槓が成立すると、次の手番は成立させたプレイヤー（の捨牌から）になる。
結果的に手番を失うプレイヤーが生じることがある。

ロンを宣言したプレイヤーがいる場合、鳴きを同時に宣言したプレイヤーを無視するものとする。

* ダブロン、トリプルロンを採用する場合、その全員のアガリとする。
* 頭ハネを採用する場合、宣言者の座席が放銃者から見て反時計回りにより近い者のアガリとする。

チーは、直近に捨てられた牌に対してしか宣言できず、下家が山から牌を引く代わりに行うものとする。
つまり、チーをしない場合は下家の手番とする。

* アガリ宣言は他の宣言に優先する。
* ポンまたは大明槓の宣言はチーのそれに優先する。

ゲーム開始前に各種宣言のタイムアウトを設定するものとする。
制限時間内に宣言がない場合、下家に手番を回すなりハイテイ流局にするなりする。

システムは捨牌が河に置かれてから次のどちらかが成り立つまでゲームを進行するのを待機するものとする：

* 他家全員の宣言意思が確定する
* タイムアウト

### 喰い替え

喰い替えはシステムが無効化するものとする：

* 宣言者が捨牌を喰って副露しようとするときに、同一の牌を自らの捨牌として選択することを無効化する。
  * さらに、順子を両面で喰って副露しようとするときに、次の牌を選択することを無効化する：
    * 上家の捨牌が順子のいちばん小さい数牌であるとき、捨牌プラス 3 の牌
    * 上家の捨牌が順子のいちばん大きい数牌であるとき、捨牌マイナス 3 の牌

喰い替え牌を選択すると、警告文を宣言者に表示するものとする。

鳴きの宣言は成立したままとする。宣言者はそれ以外の牌を制限時間内に選択するか、
タイムアウトによりシステムが牌を選択することになる。

### チー

* チーの宣言は手番のプレイヤーの下家に限られる。
* チーの宣言が成立すると、システムは当該プレイヤーに対応する効果音「チー」を再生する。
  また、画面上に「チー」と描画する。
* 必要に応じて、宣言者は非副露部手牌から順子を構成する面子に対応する牌をすべて選択する。
  * 選択時、システムは順子を構成できない牌すべてをグレーアウトする。
  * 手牌構成から副露するべき順子が一意的に定まる場合は、システムが自動判定して選択の手間を省くものとする。
    そうでない場合にプレイヤーが画面上から一つ以上の牌を選択する。
    こちらの場合も一つ選択して残りが一意的に定まる場合は自動判定する。
* 副露面子を卓上に追加的に表示する。
  * 副露面子のいちばん左の牌を喰った牌として、横に曲げて置く。
* 宣言者に非副露部手牌から捨牌を選択させる。
  * 喰い替え牌については前項参照。
* 宣言者の捨牌を河に追加する。
* 宣言者の下家に手番を回す。

### ポン

* ポンが成立すると、宣言者に対応する効果音「ポン」を再生する。
  また、画面上に「ポン」と描画する。
* システムが宣言者の非副露部手牌から刻子を構成して副露面子を卓上に追加的に表示する。
  * 捨牌が下家からの場合、副露面子のいちばん右の牌を曲げる。
  * 捨牌が対面からの場合、副露面子の中央の牌を曲げる。
  * 捨牌が上家からの場合、副露面子のいちばん左の牌を曲げる。
* 宣言者に非副露部手牌から捨牌を選択させる。
  * 喰い替え牌については前項参照。
* 宣言者の捨牌を河に追加する。
* 宣言者の下家に手番を回す。

### 大明槓

* 大明槓が成立すると、宣言者に対応する効果音「カン」を再生する。
  また、画面上に「カン」と描画する。
* システムが宣言者の非副露部手牌から槓子を構成して、副露面子を卓上に追加的に表示する。
  * 捨牌が下家からの場合、副露面子のいちばん右の牌を曲げる。
  * 捨牌が対面からの場合、副露面子の両端でない牌のどちらかを曲げる。
  * 捨牌が上家からの場合、副露面子のいちばん左の牌を曲げる。
* [カンドラめくり]

### 加槓

プレイヤーは明刻と同じ牌を非副露手牌に持つとき、加槓をすることができる。
加槓を宣言できるタイミングは、山またはリンシャンから牌を引いた直後とする。

* 加槓が成立すると、宣言者に対応する効果音「カン」を再生する。
  また、画面上に「カン」と描画する。
* 牌を明刻のうち曲げられている牌の前面に、やはり曲げて置く。
* 他家からのロン宣言を待機する。
  * ロンが成立する場合は、ロンアガリの処理に移行する。
* [カンドラめくり]

### 暗槓

プレイヤーが暗槓を宣言できるタイミングは、山またはリンシャンから牌を引いた直後とする。

* 暗槓が成立すると、宣言者に対応する効果音「カン」を再生する。
  また、画面上に「カン」と描画する。
* システムが宣言者の非副露部手牌から槓子を構成して、副露面子を卓上に追加的に表示する。
  * 四牌を直列し、両側の牌は裏側を上に向ける。
* 国士無双に限定し、他家からのロン宣言を待機する。
  * ロンが成立する場合は、ロンアガリの処理に移行する。
* [カンドラめくり]

### カンドラめくり

TODO: 暗槓と明槓でめくるタイミングと牌を切るタイミングが前後するルールもある。

* カンドラをめくる：これまでのドラ表示牌の右隣の牌をめくる。
  * ドラ情報を更新する
  * ハイテイを調整する：本来のカン数個前の牌がハイテイ牌となる。
* リンシャン牌を下ろす。
* リンシャンから牌を補充する。
* 通常の手番におけるツモ直後と同様の処理をする。

### 副露

いったん副露した面子は非副露手牌部分に組み込むことはできないし、
副露した面子から牌を捨てることもできない。

* 副露面子はプレイヤーの卓上右手側に、牌が見えるようにを卓面に倒した状態で置く。
* 複数の副露面子が発生する場合、先の副露の左側に順次置く。
* チー、ポン、カンの面子の晒し方についてはそれぞれの項に記した。

### パオ・責任払い

あるプレイヤー A が大三元または大四喜が確定するような牌を食わせた別のプレイヤー
B は、

* A がツモアガリしたときには B が点棒の全額を支払うものとする。
* 別のプレイヤー C の放銃によって A がロンアガリしたときには支払い点棒を B と C とで折半するものとする。

これをパオとか責任払いという。

* 大三元の場合は、3 種目の三元牌の明刻または明槓確定を、
* 大四喜の場合は、4 種目の風牌の明刻または明槓確定を

もってパオ成立とする。

### 四槓算了流局

場に槓子が 4 面子生じたときには次の処理をする：

* 槓子が同一プレイヤーによるもので
  * なければ、四槓算了流局例外を創出する。
  * あれば、その局は続行する。ただしシステムはこれ以降のカン宣言を無効化する。

局が続行しているならば、四槓子をテンパイしているハダカタンキのプレイヤーがただ一人いることになる。

### ロンアガリ

あるプレイヤー A がロンアガリ宣言できる条件は次の通り：

* 別のプレイヤー B の手番が牌を捨てることで終わろうとしているときに、
* その牌が A の手牌に対して少なくとも一つの役を伴う和了形を完成させるものであり、
* A がフリテンではない。

ロンアガリの手順は次の通り：

* A がロンアガリを決定すると、A に対応する効果音「ロン」を再生する。
  また、画面上に「ロン」と描画する。
* A の非副露部分の手牌を卓上に開く。

以下、アガリ画面へ。

### ツモアガリ

あるプレイヤー A がツモアガリを宣言できる条件は次の通り：

* A の手番で牌を山またはリンシャンから引いたときに、
* 引いた牌を含む手牌が有効な和了形である。

ツモアガリの手順は次の通り：

* A がツモアガリを決定すると、A に対応する効果音「ツモ」を再生する。
  また、画面上に「ツモ」と描画する。
* A の非副露部分の手牌を卓上に開く。この際、和了牌はそのいちばん右側にあるものとする。

以下、アガリ画面へ。

### テンパイ

あるプレイヤー A の手牌がテンパイであるとは、その手牌がたった一つの牌しか和了に必要としないことをいう。

* アガリ牌が A の副露したものの中にしか存在しないときでもテンパイとみなす。
* A のアガリ牌を A 自身がすでに 4 枚とも手にある場合はテンパイとはみなさない。

### リーチ

プレイヤー A が門前でテンパイしているとき、持ち点が 1000 以上ならば
A の手番で牌を捨てるときにリーチを宣言することができる。

* A がリーチを決定すると、A に対応する効果音「リーチ」を再生する。
  また、画面上に「リーチ」と描画する。
* 捨牌を曲げて河に置く。
* 他家の宣言を待機する。
  * 他家のロン宣言があれば、リーチは不成立とする。ロンの処理へ。
  * 他家のチー・ポン・カン宣言があれば、それらの処理へ。
    * A の次の捨牌は曲げておくようにする。
* 宣言がない状態で待機が終わればリーチが成立する。
* A の点棒箱から千点棒を一本取り出して所定の位置に置く。
* 下家の手番へ

システムは残り牌が 4 つ未満の巡目ではプレイヤーにリーチを宣言させないものとする。

リー棒は A がこの局内に和了すれば A に戻る。
もし他家 B がこの局内に和了すれば、B が卓上にある（供託を含む）すべてのリー棒を獲得する。
和了者が複数ならば、そのようなリー棒はすべてが A の座席を基準とする上家取りとする。

この局が流局で終われば、卓上のリー棒は供託、次局へ持ち越され、局をまたいで次の和了者が総取りする。

システムはこの局が終わるまでリーチ宣言者に手牌を変化させないものとする。
ただし和了牌を変えないような暗槓は許す：もとのテンパイ形が暗刻としかみなされないような暗刻に対してしか暗槓させないものとする。
例：テンパイに三連刻が含まれるとき、いずれの暗刻に対しても暗槓は不許可とする。
なぜなら、同一順子が三つとも解釈されることによる。

フリテン者にリーチを宣言させるのは許す。

* フリテン者にはロンアガリを許さない。ロン牌が他家に切られたときにはアガリを決定させないようにする。
  さらに画面にフリテン警告を表示する。
* A がリーチ後の和了牌を見逃したとき、システムは A をフリテンにする。

フリテン者はツモによってしか和了できないものとする。

リーチは役である。

* A がリーチ宣言の次巡までにロンまたは次巡の手番でツモアガリしたときには、さらに一発という役が付く。
  * 一発は A の次の手番までに他家からチー・ポン・（すべての）カン（・アガリ）宣言が成立すると消失する。

和了したリーチ者は裏ドラをめくるものとする：

* ドラ表示牌、カンドラ表示牌すべてを王牌から取り出し、下の段にあった牌をめくって表面を見せる。
